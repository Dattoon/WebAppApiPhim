@model MovieListResponse
@{
    ViewData["Title"] = "Phim hay có rồ";
}

<div class="container">
    <!-- Featured Slider -->
    <div id="featuredCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
        <div class="carousel-inner rounded shadow">
            @if (Model?.Data != null && Model.Data.Any())
            {
                for (int i = 0; i < Math.Min(5, Model.Data.Count); i++)
                {
                    var movie = Model.Data[i];
                    <div class="carousel-item @(i == 0 ? "active" : "")" style="height: 400px;">
                        <img src="@(movie.BackdropUrl ?? movie.ThumbUrl ?? "/placeholder.svg?height=400&width=1200")" class="d-block w-100 h-100" style="object-fit: cover;" alt="@movie.Name">
                        <div class="carousel-caption d-none d-md-block text-start" style="background: linear-gradient(to right, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%); left: 0; right: 0; bottom: 0; padding: 30px;">
                            <h2>@movie.Name</h2>
                            <p class="d-none d-lg-block">@movie.Year - @movie.Loai_phim</p>
                            <a asp-controller="Movie" asp-action="Detail" asp-route-slug="@movie.Slug" class="btn btn-primary">Xem phim</a>
                        </div>
                    </div>
                }
            }
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>

    <!-- New Movies Section -->
    <div class="section-title">
        <h2>Phim Mới Cập Nhật</h2>
        <a href="#" class="view-all">Xem tất cả <i class="fas fa-chevron-right ms-1"></i></a>
    </div>

    <div class="movie-grid">
        @if (Model?.Data != null)
        {
            foreach (var movie in Model.Data)
            {
                <div class="movie-card">
                    <a asp-controller="Movie" asp-action="Detail" asp-route-slug="@movie.Slug">
                        <img src="@(movie.PosterUrl ?? movie.ThumbUrl ?? "/placeholder.svg?height=450&width=300")" alt="@movie.Name">
                        <div class="overlay">
                            <div class="title">@movie.Name</div>
                            <div class="info">
                                @movie.Year • @movie.Loai_phim
                            </div>
                        </div>
                    </a>
                </div>
            }
        }
    </div>

    <!-- Pagination -->
    @if (Model?.Pagination != null && Model.Pagination.Total_pages > 1)
    {
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                @if (Model.Pagination.Current_page > 1)
                {
                    <li class="page-item">
                        <a class="page-link" asp-controller="Home" asp-action="Index" asp-route-page="@(Model.Pagination.Current_page - 1)" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                }

                @{
                    int startPage = Math.Max(1, Model.Pagination.Current_page - 2);
                    int endPage = Math.Min(Model.Pagination.Total_pages, startPage + 4);

                    if (endPage - startPage < 4 && startPage > 1)
                    {
                        startPage = Math.Max(1, endPage - 4);
                    }
                }

                @for (int i = startPage; i <= endPage; i++)
                {
                    <li class="page-item @(i == Model.Pagination.Current_page ? "active" : "")">
                        <a class="page-link" asp-controller="Home" asp-action="Index" asp-route-page="@i">@i</a>
                    </li>
                }

                @if (Model.Pagination.Current_page < Model.Pagination.Total_pages)
                {
                    <li class="page-item">
                        <a class="page-link" asp-controller="Home" asp-action="Index" asp-route-page="@(Model.Pagination.Current_page + 1)" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                }
            </ul>
        </nav>
    }

    <!-- Trending Movies Section -->
    <div class="section-title mt-5">
        <h2>Phim Đang Hot</h2>
        <a href="#" class="view-all">Xem tất cả <i class="fas fa-chevron-right ms-1"></i></a>
    </div>

    <div class="movie-grid">
        @if (Model?.Data != null)
        {
            foreach (var movie in Model.Data.Take(12).Reverse())
            {
                <div class="movie-card">
                    <a asp-controller="Movie" asp-action="Detail" asp-route-slug="@movie.Slug">
                        <img src="@(movie.PosterUrl ?? movie.ThumbUrl ?? "/placeholder.svg?height=450&width=300")" alt="@movie.Name">
                        <div class="overlay">
                            <div class="title">@movie.Name</div>
                            <div class="info">
                                @movie.Year • @movie.Loai_phim
                            </div>
                        </div>
                    </a>
                </div>
            }
        }
    </div>
</div>